import{n as A,a as O,c as j,E as T,b as N,d as $,r as P,o as _,e as f,f as m,w as g,g as n,F as v,h as L,u as y,i as V,t as w,j as I,k as D,l as M,m as q}from"./vendor.2872f71b.js";const C=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}};C();const B="modulepreload",S={},U="/",c=function(t,s){return!s||s.length===0?t():Promise.all(s.map(o=>{if(o=`${U}${o}`,o in S)return;S[o]=!0;const r=o.endsWith(".css"),i=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${i}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":B,r||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),r)return new Promise((u,b)=>{l.addEventListener("load",u),l.addEventListener("error",b)})})).then(()=>t())};var d={fail(e,t="",s=4e3){A({group:"error",title:e,text:t},s)},success(e,t="",s=4e3){A({group:"success",title:e,text:t},s)}};const R={success_code:200,fail_code:204},h=O.create({baseURL:"http://edu.test/api",timeout:5e4,headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},validateStatus:function(e){return e<=400}});h.interceptors.request.use(function(e){return a.dispatch("clearErrors"),a.state.token&&(e.headers.Authorization="Bearer "+a.state.token,e.headers.Role=a.state.role),e},function(e){return Promise.reject(e)});h.interceptors.response.use(function(e){return e.data.code&&e.data.code===R.success_code&&e.data.message&&d.success(e.data.message),e.data.code&&e.data.code===R.fail_code?(d.fail(e.data.message),Promise.reject(e)):e.data},function(e){if(e.response){if(e.response.status===422){let t=e.response.data.errors;a.dispatch("setErrors",t)}else e.response.status===403?(d.fail("sorry, you don not have auth"),a.dispatch("logout")):e.response.status===401?(d.fail("not login or login expired"),a.dispatch("logout")):e.response.status===429?d.fail("action too frequently"):e.response.status===404?d.fail("api not found"):e.response.status===500?d.fail("inner error"):e.response.status===405?d.fail("method not allowed"):d.fail("error happened");console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers)}else e.request?(d.fail("response nothing"),console.log(e.request)):(d.fail("request fail"),console.log("Error",e.message));return console.log(e.config),Promise.reject(e)});const x=(e,t)=>{const s=t.auth.accessToken,o=t.role;localStorage.setItem("token",s),localStorage.setItem("role",o),localStorage.setItem("user",JSON.stringify(t.user)),e("setAuth",{token:s,role:o}),e("setUser",t.user),E.push(`/${o}/home`)},W=j({state(){return{token:localStorage.getItem("token"),role:localStorage.getItem("role"),user:JSON.parse(localStorage.getItem("user")),people:[],errors:{},newMessage:{message:null,fromName:""},talkingWith:null,unreadAdmin:0}},getters:{getUser(e){return e.user},getErrors(e){return e.errors},token(e){return e.token},role(e){return e.role},hasToken(e){return Boolean(e.token)},newMessage(e){return e.newMessage}},mutations:{setAuth(e,{token:t,role:s}){e.token=t,e.role=s},setUser(e,t){e.user=t},setErrors(e,t){e.errors=t},setNewMessage(e,t){e.newMessage=t},clearNewMessage(e,t){e.newMessage.message&&t===e.newMessage.message.id&&(e.newMessage={message:null,fromName:""})},talkingTo(e,t){e.talkingWith=+t},leaveTalk(e){e.talkingWith=null},setPeople(e,t){e.people=t},setUnreadAdmin(e,t){e.unreadAdmin=t}},actions:{login({commit:e},t){h.post("login",t).then(({data:s})=>{x(e,s)})},normalTeacherLogin({commit:e},t){h.post("normal_teacher",t).then(({data:s})=>{x(e,s)})},lineBind({commit:e},{official_id:t,form:s}){h.post("/line/"+t+"/users",s).then(({data:o})=>{x(e,o)})},lineLogin({commit:e},t){h.post("/line/login",t).then(({data:s})=>{x(e,s)})},logout({commit:e}){localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("user"),e("setAuth",{token:null,role:null}),e("setUser",null),E.push("/login")},setErrors({commit:e},t){e("setErrors",t)},clearErrors({commit:e}){e("setErrors",{})},messageReceived({commit:e,state:t},s){s.message.from_id!==t.talkingWith&&(t.people.find(o=>o.id===+s.message.from_id).unread=!0,d.success("new message from "+s.fromName,s.message.message,1e4)),e("setNewMessage",s)},getStudentsOfSchool({commit:e,state:t},s=null){let o=s||t.user.school_id;h.get(`/schools/${o}/students`).then(r=>{e("setPeople",r)})},getTeachersOfSchool({commit:e,state:t}){h.get("/students/teachers").then(s=>{e("setPeople",s)})},checkAdminMessages({commit:e,state:t}){const s=t.role==="student"?"student":"teacher";h.get(`/${s}/admin-messages/check`).then(({data:o})=>{e("setUnreadAdmin",o)})}}});var a=W;const p={Principal:"principal",Normal:"normal",Student:"student"},H={principal(){return a.getters.token&&a.getters.role===p.Principal},normal(){return a.getters.token&&a.getters.role===p.Normal},student(){return a.getters.token&&a.getters.role===p.Student},guest(){return!a.getters.hasToken}};function ye(){const e=a.state.role===p.Student?"student":"teacher";new T({broadcaster:"pusher",key:"46d8134de723d77a6256",disableStats:!0,authEndpoint:`http://edu.test/api/broadcast/auth/${e}`,auth:{headers:{Authorization:"Bearer "+a.getters.token}}}).private(`chat.${e}${a.state.user.id}`).listen("Chat",s=>{a.dispatch("messageReceived",s)})}const F=[{path:"/",name:"Home",redirect:e=>a.getters.role===p.Principal?"/principal/home":a.getters.role===p.Normal?"/normal/home":a.getters.role===p.Student?"/student/home":"/login"},{path:"/principal",component:()=>c(()=>import("./layout.a7a3a2ae.js"),["assets/layout.a7a3a2ae.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"principal"},children:[{path:"home",component:()=>c(()=>import("./home.b8b6aa25.js"),["assets/home.b8b6aa25.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js","assets/Chat.02e3e4b2.js"])},{path:"invitations",component:()=>c(()=>import("./invitations.723c19de.js"),["assets/invitations.723c19de.js","assets/plugin-vue_export-helper.5a098b48.js","assets/vendor.2872f71b.js"])},{path:"admin-message",component:()=>c(()=>import("./message.182aa65d.js"),["assets/message.182aa65d.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"])}]},{path:"/normal",component:()=>c(()=>import("./layout.a7a3a2ae.js"),["assets/layout.a7a3a2ae.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"normal"},children:[{path:"home",component:()=>c(()=>import("./home.3b474832.js"),["assets/home.3b474832.js","assets/Chat.02e3e4b2.js","assets/plugin-vue_export-helper.5a098b48.js","assets/vendor.2872f71b.js"]),props:e=>({chat_user_id:e.query.chat_user_id,chat_user_name:e.query.chat_user_name})}]},{path:"/student",component:()=>c(()=>import("./layout.a7a3a2ae.js"),["assets/layout.a7a3a2ae.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"student"},children:[{path:"home",component:()=>c(()=>import("./home.d4697b10.js"),["assets/home.d4697b10.js","assets/Chat.02e3e4b2.js","assets/plugin-vue_export-helper.5a098b48.js","assets/vendor.2872f71b.js"]),props:e=>({chat_user_id:e.query.chat_user_id,chat_user_name:e.query.chat_user_name})},{path:"admin-message",component:()=>c(()=>import("./message.182aa65d.js"),["assets/message.182aa65d.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"])}]},{name:"login",path:"/login",component:()=>c(()=>import("./login.61f08849.js"),["assets/login.61f08849.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"guest"}},{path:"/register",component:()=>c(()=>import("./register.80bfec7f.js"),["assets/register.80bfec7f.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"guest"}},{path:"/line/login",component:()=>c(()=>import("./lineLogin.45d62f91.js"),["assets/lineLogin.45d62f91.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"]),meta:{middleware:"guest"}},{path:"/invitation",component:()=>c(()=>import("./invitation_detail.b6edc82d.js"),["assets/invitation_detail.b6edc82d.js","assets/vendor.2872f71b.js","assets/plugin-vue_export-helper.5a098b48.js"])}],E=N({history:$(),routes:F});E.beforeEach((e,t)=>{let s=e.meta.middleware;if(s){typeof s=="string"&&(s=[s]);for(let o of s)if(!H[o]())return d.fail("auth middleware not allowed"),t}return!0});const z={class:"fixed inset-0 flex items-start justify-end p-6 px-4 py-6 pointer-events-none"},G={class:"w-full max-w-sm"},J={class:"max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden border"},X={class:"p-4"},K={class:"flex items-start"},Q={class:"flex-shrink-0"},Y={class:"ml-3 w-0 flex-1 pt-0.5"},Z={class:"text-sm font-medium text-gray-900"},ee={class:"mt-1 text-sm text-gray-500"},te={class:"ml-4 flex-shrink-0 flex"},se=["onClick"],oe=n("span",{class:"sr-only"},"Close",-1),re={class:"fixed inset-0 flex items-start justify-end p-6 px-4 py-6 pointer-events-none"},ne={class:"w-full max-w-sm"},ae={class:"max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden"},ie={class:"p-4"},le={class:"flex items-start"},ce={class:"flex-shrink-0"},de={class:"ml-3 w-0 flex-1 pt-0.5"},ue={class:"text-sm font-medium text-gray-900"},me={class:"mt-1 text-sm text-gray-500"},he={class:"ml-4 flex-shrink-0 flex"},pe=["onClick"],_e=n("span",{class:"sr-only"},"Close",-1),fe={setup(e){return(t,s)=>{const o=P("Notification",!0),r=P("NotificationGroup");return _(),f(v,null,[m(r,{group:"success"},{default:g(()=>[n("div",z,[n("div",G,[m(o,{enter:"transform ease-out duration-300 transition","enter-from":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-4","enter-to":"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-500","leave-from":"opacity-100","leave-to":"opacity-0",move:"transition duration-500","move-delay":"delay-300"},{default:g(({notifications:i,close:l})=>[(_(!0),f(v,null,L(i,u=>(_(),f("div",{class:"flex w-full max-w-sm mx-auto mt-4 overflow-hidden bg-white rounded-lg shadow-md",key:u.id},[n("div",J,[n("div",X,[n("div",K,[n("div",Q,[m(y(V),{class:"h-6 w-6 text-green-400","aria-hidden":"true"})]),n("div",Y,[n("p",Z,w(u.title),1),n("p",ee,w(u.text),1)]),n("div",te,[n("button",{onClick:b=>l(u.id),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[oe,m(y(I),{class:"h-5 w-5","aria-hidden":"true"})],8,se)])])])])]))),128))]),_:1})])])]),_:1}),m(r,{group:"error"},{default:g(()=>[n("div",re,[n("div",ne,[m(o,{enter:"transform ease-out duration-300 transition","enter-from":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-4","enter-to":"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-500","leave-from":"opacity-100","leave-to":"opacity-0",move:"transition duration-500","move-delay":"delay-300"},{default:g(({notifications:i,close:l})=>[(_(!0),f(v,null,L(i,u=>(_(),f("div",{class:"flex w-full max-w-sm mx-auto mt-4 overflow-hidden bg-white rounded-lg shadow-md",key:u.id},[n("div",ae,[n("div",ie,[n("div",le,[n("div",ce,[m(y(D),{class:"h-6 w-6 text-red-600","aria-hidden":"true"})]),n("div",de,[n("p",ue,w(u.title),1),n("p",me,w(u.text),1)]),n("div",he,[n("button",{onClick:b=>l(u.id),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[_e,m(y(I),{class:"h-5 w-5","aria-hidden":"true"})],8,pe)])])])])]))),128))]),_:1})])])]),_:1})],64)}}},ge={setup(e){return(t,s)=>{const o=P("router-view");return _(),f(v,null,[m(o),m(fe)],64)}}},k=M(ge);k.use(a);k.use(E);k.use(q);k.mount("#app");export{p as R,h,ye as r,a as s};
