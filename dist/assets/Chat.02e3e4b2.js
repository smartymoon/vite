import{h as u,R as y}from"./index.c17962c1.js";import{_}from"./plugin-vue_export-helper.5a098b48.js";import{o as n,e as i,L as m,g as t,B as x,r as b,F as g,h as v,K as f,t as c,f as k,C as p,W as w,a0 as C,a1 as $,a2 as M,a3 as j}from"./vendor.2872f71b.js";const B={props:{canEdit:{type:Boolean,required:!0},person:{type:Object,required:!0}},setup(s){return{handleFollow(){u.post("/follow/"+s.person.id).then(a=>{s.person.follow_id=a})},handleUnFollow(){u.post("/unfollow/"+s.person.id).then(()=>{s.person.follow_id=null})}}}},E={key:0,class:"cursor-pointer"},q={key:0},F=t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1),S=[F],L={key:1,class:"text-red-500"},O=t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"},null,-1),D=[O],W={key:1,class:"text-red-500"},H=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1),J=[H];function Q(s,a,r,e,h,l){return r.canEdit?(n(),i("div",E,[r.person.follow_id?(n(),i("div",L,[(n(),i("svg",{onClick:a[1]||(a[1]=(...o)=>e.handleUnFollow&&e.handleUnFollow(...o)),xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},D))])):(n(),i("div",q,[(n(),i("svg",{onClick:a[0]||(a[0]=(...o)=>e.handleFollow&&e.handleFollow(...o)),xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},S))]))])):r.person.follow_id?(n(),i("div",W,J)):m("",!0)}var T=_(B,[["render",Q]]);const U=["https://images.unsplash.com/photo-1519345182560-3f2917c472ef?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","https://images.unsplash.com/photo-1463453091185-61582044d556?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","https://images.unsplash.com/photo-1502685104226-ee32379fefbe?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","https://images.unsplash.com/photo-1500917293891-ef795e70e1f6?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"],z={props:{people:{type:Array,required:!0}},components:{Follow:T},setup(s,{emit:a}){const r=x();return{avatars:U,canEdit:r.getters.role===y.Student,handleClick(e){a("chat",e.id,e.name),e.unread=!1}}}},V={class:"pb-4 border rounded"},K={class:"flow-root mt-6"},N={role:"list",class:"-my-5 divide-y divide-gray-200"},R={class:"flex items-center space-x-4"},P={class:"flex-shrink-0 relative"},A=["src"],I={key:0,class:"absolute right-0 bottom-0"},G=t("div",{class:"rounded-full h-3 w-3 bg-red-400"},null,-1),X=[G],Y={class:"flex-1 min-w-0"},Z={class:"text-sm font-medium text-gray-900 truncate"},ee={class:"text-xs text-gray-500"},te={class:"flex gap-1"},oe=["onClick"];function se(s,a,r,e,h,l){const o=b("Follow");return n(),i("div",V,[t("div",K,[t("ul",N,[(n(!0),i(g,null,v(r.people,d=>(n(),i("li",{class:f(["py-4 px-2 mx-2",s.$store.state.talkingWith===d.id?"bg-blue-100 rounded overflow-hidden":""])},[t("div",R,[t("div",P,[t("img",{class:"h-8 w-8 rounded-full",src:e.avatars[Math.floor(Math.random()*4)],alt:""},null,8,A),d.unread?(n(),i("div",I,X)):m("",!0)]),t("div",Y,[t("p",Z,c(d.name),1),t("p",ee,c(d.email),1)]),t("div",te,[t("a",{onClick:ve=>e.handleClick(d),class:f([d.unread?"text-red-400 border-red-300":"","inline-flex items-center shadow-sm px-2.5 py-0.5 border border-gray-300 text-sm leading-5 font-medium rounded-full text-gray-700 bg-white hover:bg-gray-50"])},c(d.unread?"UnRead":"Chat"),11,oe),k(o,{canEdit:e.canEdit,person:d},null,8,["canEdit","person"])])])],2))),256))])])])}var be=_(z,[["render",se]]);const ae=["https://images.unsplash.com/photo-1519345182560-3f2917c472ef?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","https://images.unsplash.com/photo-1463453091185-61582044d556?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"],re={props:{talkTo:{type:String,required:!0},me:{type:Object,required:!0},another:{type:Object,required:!0}},setup(s){const a=x(),r=p([]),e=p("");w(()=>a.getters.newMessage,({message:l})=>{!l||l.from_id===+s.another.id&&(r.value.push({id:l.id,message:l.message,mine:!1,created_at:l.created_at}),u.put("/message/"+s.me.role+"/"+l.id+"/read").then(()=>{console.log("message "+l.id+" seen")}))});const h=()=>{!s.another.id||(a.commit("talkingTo",s.another.id),u.get("/messages/"+s.me.role+"/"+s.another.id).then(l=>{r.value=l.map(o=>({id:o.id,message:o.message,mine:o.from_id===s.me.id&&o.from_type===s.me.role,created_at:o.created_at}))}))};return C(()=>{h()}),w(()=>s.another.id,()=>{h()}),{avatars:ae,talks:r,current_message:e,handleSent(){!e.value||u.post("messages/"+s.me.role,{toId:s.another.id,message:e.value}).then(({data:l})=>{e.value="",r.value.push({id:l.id,message:l.message,mine:!0,created_at:l.created_at})})}}}},le={key:0,class:"border p-3 rounded flex flex-col h-full"},ne={class:"text-lg border-b pb-2"},ie={class:"overflow-y-scroll p-3 mt-3 flex flex-col-reverse h-full flex-auto",style:{height:"600px"}},de={key:0},ce=["src"],he={class:"text-sm bg-blue-300 rounded-lg px-2 py-1 text-white max-w-xs"},ue={key:1,class:"text-center mt-20 text-gray-400 text-xl"},fe={class:"relative flex items-center mt-3"},_e=t("kbd",{class:"inline-flex items-center border border-gray-200 rounded px-2 text-sm font-sans font-medium text-gray-400 bg-gray-200"}," Send ",-1),me=[_e],xe={key:1,class:"text-center mt-20 text-gray-400 text-xl"};function ge(s,a,r,e,h,l){return r.talkTo?(n(),i("div",le,[t("h2",ne,"Chat with "+c(r.talkTo),1),t("div",ie,[e.talks.length>0?(n(),i("div",de,[(n(!0),i(g,null,v(e.talks,o=>(n(),i("div",{key:o.id,class:f(["flex my-3 items-top space-x-2",o.mine?"flex-row-reverse space-x-reverse":"justify-start"])},[t("img",{class:"h-8 w-8 rounded-full",src:o.mine?e.avatars[0]:e.avatars[1],alt:""},null,8,ce),t("div",null,[t("div",he,c(o.message),1),t("p",{class:f(["text-gray-300 text-xs",o.mine?"text-right":""])},c(o.created_at),3)])],2))),128))])):(n(),i("div",ue," no messages "))]),t("div",fe,[$(t("input",{onKeyup:a[0]||(a[0]=j((...o)=>e.handleSent&&e.handleSent(...o),["enter"])),autofocus:"","onUpdate:modelValue":a[1]||(a[1]=o=>e.current_message=o),placeholder:"write message here",type:"text",name:"search",id:"search",class:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md"},null,544),[[M,e.current_message]]),t("div",{onClick:a[2]||(a[2]=(...o)=>e.handleSent&&e.handleSent(...o)),class:"absolute inset-y-0 right-0 flex py-1.5 pr-1.5 cursor-pointer"},me)])])):(n(),i("div",xe," pick a "+c(r.another.role)+" to have a chat ",1))}var ke=_(re,[["render",ge]]);export{ke as C,be as P};
